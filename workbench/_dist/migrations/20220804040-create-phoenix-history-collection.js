"use strict";var p=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var v=(e,i)=>{for(var s in i)p(e,s,{get:i[s],enumerable:!0})},C=(e,i,s,a)=>{if(i&&typeof i=="object"||typeof i=="function")for(let t of D(i))!S.call(e,t)&&t!==s&&p(e,t,{get:()=>i[t],enumerable:!(a=N(i,t))||a.enumerable});return e};var O=e=>C(p({},"__esModule",{value:!0}),e);var X={};v(X,{down:()=>H,up:()=>U});module.exports=O(X);var y="external_systems";var _="phoenix_config",m="phoenix_history";var n=e=>e?typeof e=="string"?e:JSON.stringify(e):null,E=()=>({readonly:!1,hidden:!1,width:"full",interface:"input",display:"raw",required:!1}),K=(e,i,s)=>{let{field:a,required:t}=s,{db_type:o,indexed:c,primary:g,options:f,relation:d,default_value:u}=s.db_options,l=f?i[o](a,f):i[o](a);return g&&l.primary(),c&&l.index(),u&&l.defaultTo(u==="current_timestamp"?e.fn.now():u),t&&l.notNullable(),d&&l.references(d.references).inTable(d.collection).onUpdate(d.onUpdate??"NO ACTION").onDelete(d.onDelete??"SET NULL"),l},F=async(e,i)=>{let s=e.isTransaction?e:await e.transaction(),a={...E(),...i};try{await s("directus_fields").insert({collection:a.collection,field:a.field,special:a.special,interface:a.interface,options:n(a.options),display:a.display,display_options:n(a.display_options),readonly:a.readonly,hidden:a.hidden,sort:a.sort,width:a.width,translations:n(a.translations),note:a.note,conditions:n(a.conditions),required:a.required}),a.db_options?.relation&&await s("directus_relations").insert({many_collection:a.collection,many_field:a.field,one_collection:a.db_options.relation.collection,one_deselect_action:"nullify"}),e.isTransaction||await s.commit()}catch(t){if(!e.isTransaction)await s.rollback();else throw t}},I=async(e,i)=>{let s=e.isTransaction?e:await e.transaction(),t={...{layout:"tabular",icon:"bookmark_outline"},...i};try{await s("directus_presets").insert({bookmark:t.bookmark,user:t.user,role:t.role,collection:t.collection,layout_query:n(t.layout_query),layout_options:n(t.layout_options),refresh_interval:t.refresh_interval,filter:t.filter,icon:t.icon,color:t.color}),e.isTransaction||await s.commit()}catch(o){if(!e.isTransaction)await s.rollback();else throw o}};var h=async(e,i)=>{let s=e.isTransaction?e:await e.transaction(),t={...{hidden:!1,singleton:!1,accountability:null,collapse:"open"},...i};try{await s.schema.createTable(t.collection,o=>{t.fields.map(c=>K(s,o,c))}),await s("directus_collections").insert({collection:t.collection,icon:t.icon,note:t.note,display_template:n(t.display_template),hidden:t.hidden,singleton:t.singleton,translations:n(t.translations),archive_field:t.archive_field,archive_app_filter:t.archive_app_filter,archive_value:t.archive_value,unarchive_value:t.unarchive_value,sort_field:t.sort_field,accountability:t.accountability,color:t.color,sort:t.sort,group:t.group,collapse:t.collapse}),await Promise.all(t.fields.map((o,c)=>F(s,{sort:c,...o}))),t.presets&&t.presets.length>0&&await Promise.all(t.presets.map(o=>I(s,o))),e.isTransaction||await s.commit()}catch(o){if(!e.isTransaction)await s.rollback();else throw o}};var w=async(e,i)=>{await e("directus_collections").where({collection:i}).delete(),await e("directus_fields").where({collection:i}).delete(),await e("directus_revisions").where({collection:i}).delete(),await e("directus_relations").where({many_collection:i}).delete(),await e("directus_relations").where({one_collection:i}).delete(),await e("directus_activity").where({collection:i}).delete(),await e.schema.hasTable(i)&&await e.schema.dropTable(i)},T=e=>({collection:e,field:"uuid",special:"uuid",interface:"input",readonly:!0,hidden:!0,sort:1,width:"full",required:!1,db_options:{db_type:"uuid",primary:!0}}),L=e=>({collection:e,field:"date_updated",special:"cast-timestamp,date-updated",interface:"datetime",display:"datetime",display_options:JSON.stringify({relative:!0}),readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"timestamp",default_value:"current_timestamp"}}),P=e=>({collection:e,field:"date_created",special:"cast-timestamp,date-created",interface:"datetime",display:"datetime",display_options:JSON.stringify({relative:!0}),readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"timestamp",default_value:"current_timestamp"}}),q=e=>({collection:e,field:"user_created",special:"user-created",interface:"select-dropdown-m2o",options:JSON.stringify({template:"{{avatar.$thumbnail}} {{first_name}} {{last_name}}"}),display:"user",readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"uuid",relation:{references:"id",collection:"directus_users",onUpdate:"NO ACTION",onDelete:"SET NULL"}}}),A=e=>({collection:e,field:"user_updated",special:"user-created",interface:"select-dropdown-m2o",options:JSON.stringify({template:"{{avatar.$thumbnail}} {{first_name}} {{last_name}}"}),display:"user",readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"uuid",relation:{references:"id",collection:"directus_users",onUpdate:"NO ACTION",onDelete:"SET NULL"}}}),b=e=>[q(e),A(e)],x=e=>[P(e),L(e)];var r=m,U=async e=>{await h(e,{collection:r,fields:[T(r),{collection:r,field:"phoenix_config",special:"m2o",interface:"select-dropdown-m2o",options:{template:"{{connection_alpha.title}}\xA0vs.\xA0{{connection_omega.title}}"},display:null,readonly:!0,required:!0,db_options:{db_type:"uuid",relation:{collection:_,references:"uuid"}}},{collection:r,field:"system_name_alpha",special:"m2o",interface:"select-dropdown-m2o",options:{template:"{{title}}"},display:"related-values",display_options:{template:"{{title}}"},readonly:!0,required:!0,width:"half",db_options:{db_type:"uuid",relation:{collection:y,references:"uuid"}}},{collection:r,field:"system_name_omega",special:"m2o",interface:"select-dropdown-m2o",options:{template:"{{title}}"},display:"related-values",display_options:{template:"{{title}}"},readonly:!0,required:!0,width:"half",db_options:{db_type:"uuid",relation:{collection:y,references:"uuid"}}},{collection:r,field:"status",required:!0,db_options:{db_type:"string"}},...b(r),...x(r)],presets:[{collection:r,layout:"tabular",layout_query:{tabular:{fields:["system_name_alpha","system_name_omega","status","date_updated"]}},layout_options:{tabular:{widths:{},spacing:"compact"}}}]})},H=async e=>{await w(e,r)};0&&(module.exports={down,up});
