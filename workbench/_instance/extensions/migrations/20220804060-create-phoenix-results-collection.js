"use strict";var p=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var D=(e,i)=>{for(var r in i)p(e,r,{get:i[r],enumerable:!0})},C=(e,i,r,a)=>{if(i&&typeof i=="object"||typeof i=="function")for(let t of S(i))!v.call(e,t)&&t!==r&&p(e,t,{get:()=>i[t],enumerable:!(a=N(i,t))||a.enumerable});return e};var E=e=>C(p({},"__esModule",{value:!0}),e);var X={};D(X,{down:()=>H,up:()=>U});module.exports=E(X);var f="external_systems";var _="phoenix_history",m="phoenix_results";var n=e=>e?typeof e=="string"?e:JSON.stringify(e):null,O=()=>({readonly:!1,hidden:!1,width:"full",interface:"input",display:"raw",required:!1}),K=(e,i,r)=>{let{field:a,required:t}=r,{db_type:s,indexed:c,primary:g,options:y,relation:d,default_value:u}=r.db_options,l=y?i[s](a,y):i[s](a);return g&&l.primary(),c&&l.index(),u&&l.defaultTo(u==="current_timestamp"?e.fn.now():u),t&&l.notNullable(),d&&l.references(d.references).inTable(d.collection).onUpdate(d.onUpdate??"NO ACTION").onDelete(d.onDelete??"SET NULL"),l},F=async(e,i)=>{let r=e.isTransaction?e:await e.transaction(),a={...O(),...i};try{await r("directus_fields").insert({collection:a.collection,field:a.field,special:a.special,interface:a.interface,options:n(a.options),display:a.display,display_options:n(a.display_options),readonly:a.readonly,hidden:a.hidden,sort:a.sort,width:a.width,translations:n(a.translations),note:a.note,conditions:n(a.conditions),required:a.required}),a.db_options?.relation&&await r("directus_relations").insert({many_collection:a.collection,many_field:a.field,one_collection:a.db_options.relation.collection,one_deselect_action:"nullify"}),e.isTransaction||await r.commit()}catch(t){if(!e.isTransaction)await r.rollback();else throw t}},L=async(e,i)=>{let r=e.isTransaction?e:await e.transaction(),t={...{layout:"tabular",icon:"bookmark_outline"},...i};try{await r("directus_presets").insert({bookmark:t.bookmark,user:t.user,role:t.role,collection:t.collection,layout_query:n(t.layout_query),layout_options:n(t.layout_options),refresh_interval:t.refresh_interval,filter:t.filter,icon:t.icon,color:t.color}),e.isTransaction||await r.commit()}catch(s){if(!e.isTransaction)await r.rollback();else throw s}};var h=async(e,i)=>{let r=e.isTransaction?e:await e.transaction(),t={...{hidden:!1,singleton:!1,accountability:null,collapse:"open"},...i};try{await r.schema.createTable(t.collection,s=>{t.fields.map(c=>K(r,s,c))}),await r("directus_collections").insert({collection:t.collection,icon:t.icon,note:t.note,display_template:n(t.display_template),hidden:t.hidden,singleton:t.singleton,translations:n(t.translations),archive_field:t.archive_field,archive_app_filter:t.archive_app_filter,archive_value:t.archive_value,unarchive_value:t.unarchive_value,sort_field:t.sort_field,accountability:t.accountability,color:t.color,sort:t.sort,group:t.group,collapse:t.collapse}),await Promise.all(t.fields.map((s,c)=>F(r,{sort:c,...s}))),t.presets&&t.presets.length>0&&await Promise.all(t.presets.map(s=>L(r,s))),e.isTransaction||await r.commit()}catch(s){if(!e.isTransaction)await r.rollback();else throw s}};var w=async(e,i)=>{await e("directus_collections").where({collection:i}).delete(),await e("directus_fields").where({collection:i}).delete(),await e("directus_revisions").where({collection:i}).delete(),await e("directus_relations").where({many_collection:i}).delete(),await e("directus_relations").where({one_collection:i}).delete(),await e("directus_activity").where({collection:i}).delete(),await e.schema.hasTable(i)&&await e.schema.dropTable(i)},T=e=>({collection:e,field:"uuid",special:"uuid",interface:"input",readonly:!0,hidden:!0,sort:1,width:"full",required:!1,db_options:{db_type:"uuid",primary:!0}}),q=e=>({collection:e,field:"date_updated",special:"cast-timestamp,date-updated",interface:"datetime",display:"datetime",display_options:JSON.stringify({relative:!0}),readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"timestamp",default_value:"current_timestamp"}}),I=e=>({collection:e,field:"date_created",special:"cast-timestamp,date-created",interface:"datetime",display:"datetime",display_options:JSON.stringify({relative:!0}),readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"timestamp",default_value:"current_timestamp"}}),P=e=>({collection:e,field:"user_created",special:"user-created",interface:"select-dropdown-m2o",options:JSON.stringify({template:"{{avatar.$thumbnail}} {{first_name}} {{last_name}}"}),display:"user",readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"uuid",relation:{references:"id",collection:"directus_users",onUpdate:"NO ACTION",onDelete:"SET NULL"}}}),A=e=>({collection:e,field:"user_updated",special:"user-created",interface:"select-dropdown-m2o",options:JSON.stringify({template:"{{avatar.$thumbnail}} {{first_name}} {{last_name}}"}),display:"user",readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"uuid",relation:{references:"id",collection:"directus_users",onUpdate:"NO ACTION",onDelete:"SET NULL"}}}),b=e=>[P(e),A(e)],x=e=>[I(e),q(e)];var o=m,U=async e=>{await h(e,{collection:o,fields:[T(o),{collection:o,field:"phoenix_history",special:"m2o",interface:"select-dropdown-m2o",display:"related-values",readonly:!0,required:!0,db_options:{db_type:"uuid",relation:{collection:_,references:"uuid"}}},{collection:o,field:"external_system",special:"m2o",interface:"select-dropdown-m2o",options:{template:"{{title}}"},display:"related-values",display_options:{template:"{{title}}"},readonly:!0,required:!0,db_options:{db_type:"uuid",relation:{collection:f,references:"uuid"}}},{collection:o,field:"distinct_field",required:!0,width:"half",db_options:{db_type:"string"}},{collection:o,field:"distinct_field_description",required:!0,width:"half",db_options:{db_type:"string"}},{collection:o,field:"missing_count",required:!0,db_options:{db_type:"integer"}},{collection:o,field:"not_in_sync_count",required:!0,db_options:{db_type:"integer"}},{collection:o,field:"orphaned_count",required:!0,db_options:{db_type:"integer"}},{collection:o,field:"match_percent",required:!0,display:"formatted-value",display_options:{suffix:" %",conditionalFormatting:[{operator:"lt",value:94.99,color:"#E35169"},{operator:"gt",value:95,color:"#FFC23B"},{operator:"eq",value:100,color:"#2ECDA7"}]},db_options:{db_type:"float"}},...b(o),...x(o)],presets:[{collection:o,layout:"tabular",layout_query:{tabular:{fields:["external_system.system_name","distinct_field","missing_count","not_in_sync_count","orphaned_count","match_percent","phoenix_history.date_updated"],sort:["external_system.system_name"],page:1}},layout_options:{tabular:{widths:{},spacing:"compact"}}}]})},H=async e=>{await w(e,o)};0&&(module.exports={down,up});
