"use strict";var n=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var x=(e,i)=>{for(var l in i)n(e,l,{get:i[l],enumerable:!0})},O=(e,i,l,a)=>{if(i&&typeof i=="object"||typeof i=="function")for(let t of T(i))!U.call(e,t)&&t!==l&&n(e,t,{get:()=>i[t],enumerable:!(a=F(i,t))||a.enumerable});return e};var q=e=>O(n({},"__esModule",{value:!0}),e);var P={};x(P,{down:()=>L,up:()=>S});module.exports=q(P);var y=e=>({collection:e,field:"uuid",special:"uuid",interface:"input",readonly:!0,hidden:!0,sort:1,width:"full",required:!1,db_options:{db_type:"uuid",primary:!0}}),h=e=>({collection:e,field:"date_updated",special:"cast-timestamp,date-updated",interface:"datetime",display:"datetime",display_options:JSON.stringify({relative:!0}),readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"timestamp",default_value:"current_timestamp"}}),m=e=>({collection:e,field:"date_created",special:"cast-timestamp,date-created",interface:"datetime",display:"datetime",display_options:JSON.stringify({relative:!0}),readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"timestamp",default_value:"current_timestamp"}}),w=e=>({collection:e,field:"user_created",special:"user-created",interface:"select-dropdown-m2o",options:JSON.stringify({template:"{{avatar.$thumbnail}} {{first_name}} {{last_name}}"}),display:"user",readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"uuid",relation:{references:"id",collection:"directus_users",onUpdate:"NO ACTION",onDelete:"SET NULL"}}}),b=e=>({collection:e,field:"user_updated",special:"user-created",interface:"select-dropdown-m2o",options:JSON.stringify({template:"{{avatar.$thumbnail}} {{first_name}} {{last_name}}"}),display:"user",readonly:!0,hidden:!0,width:"half",required:!1,db_options:{db_type:"uuid",relation:{references:"id",collection:"directus_users",onUpdate:"NO ACTION",onDelete:"SET NULL"}}}),K=async(e,i)=>{let a={...{readonly:!1,hidden:!1,width:"full",required:!1},...i};await e("directus_fields").insert({collection:a.collection,field:a.field,special:a.special,interface:a.interface,display:a.display,readonly:a.readonly,hidden:a.hidden,sort:a.sort,width:a.width,note:a.note,conditions:a.conditions,required:a.required}),a.db_options?.relation&&await e("directus_relations").insert({many_collection:a.collection,many_field:a.field,one_collection:a.db_options.relation.collection,one_deselect_action:"nullify"})},v=async(e,i)=>{let l=await e.transaction(),t={...{hidden:!1,singleton:!1,accountability:null,collapse:"open"},...i};try{await l.schema.createTable(t.collection,d=>{t.fields.map(u=>{let{field:p,required:D}=u,{db_type:f,indexed:C,primary:N,options:_,relation:s,default_value:c}=u.db_options,o=_?d[f](p,_):d[f](p);return N&&o.primary(),C&&o.index(),c&&o.defaultTo(c==="current_timestamp"?e.fn.now():c),D&&o.notNullable(),s&&o.references(s.references).inTable(s.collection).onUpdate(s.onUpdate??"NO ACTION").onDelete(s.onDelete??"SET NULL"),o})}),await l("directus_collections").insert({collection:t.collection,icon:t.icon,note:t.note,hidden:t.hidden,singleton:t.singleton,archive_field:t.archive_field,archive_app_filter:t.archive_app_filter,archive_value:t.archive_value,unarchive_value:t.unarchive_value,sort_field:t.sort_field,accountability:t.accountability,color:t.color,sort:t.sort,group:t.group,collapse:t.collapse}),await Promise.all(t.fields.map(d=>K(l,d))),await l.commit()}catch{await l.rollback()}};var g=async(e,i)=>{await e("directus_collections").where({collection:i}).delete(),await e("directus_fields").where({collection:i}).delete(),await e("directus_revisions").where({collection:i}).delete(),await e("directus_relations").where({many_collection:i}).delete(),await e("directus_relations").where({one_collection:i}).delete(),await e("directus_activity").where({collection:i}).delete(),await e.schema.dropTable(i)};var r="test_collection_2",S=async e=>{await v(e,{collection:r,fields:[y(r),{collection:r,field:"title",interface:"input",display:"raw",db_options:{db_type:"string"}},w(r),b(r),m(r),h(r)]})},L=async e=>{await g(e,r)};0&&(module.exports={down,up});
